periodics:
- decorate: true
  decoration_config:
    timeout: 6000000000000 # 100 minutes
  interval: 30m
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  name: ci-kubernetes-e2e-gke-staging-default-parallel
  spec:
    containers:
    - args:
      - --check-leaked-resources
      - --check-version-skew=false
      - --cluster=
      - --deployment=gke
      - --extract=gke
      - --gcp-cloud-sdk=gs://cloud-sdk-testing/rc
      - --gcp-node-image=gci
      - --gcp-project-type=gke-internal-project
      - --gcp-zone=us-central1-f
      - --ginkgo-parallel
      - --gke-environment=staging
      - --provider=gke
      - --test_args=--ginkgo.skip=\[Slow\]|\[Serial\]|\[Disruptive\]|\[Flaky\]|\[Feature:.+\] --minStartupPods=8
      - --timeout=80m
      command:
      - runner.sh
      - /workspace/scenarios/kubernetes_e2e.py
      image: gcr.io/gke-test-infra/kubekins-e2e:v20181221-f9eff05-master

- decorate: true
  decoration_config:
    timeout: 49200000000000 # 820 minutes
  interval: 30m
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  name: ci-kubernetes-e2e-gke-staging-default-serial
  spec:
    containers:
    - args:
      - --check-leaked-resources
      - --check-version-skew=false
      - --cluster=
      - --deployment=gke
      - --extract=gke
      - --gcp-cloud-sdk=gs://cloud-sdk-testing/rc
      - --gcp-node-image=gci
      - --gcp-project-type=gke-internal-project
      - --gcp-zone=us-central1-f
      - --gke-environment=staging
      - --provider=gke
      - --test_args=--ginkgo.focus=\[Slow\]|\[Serial\]|\[Disruptive\] --ginkgo.skip=\[Flaky\]|\[Feature:.+\] --minStartupPods=8
      - --timeout=800m
      command:
      - runner.sh
      - /workspace/scenarios/kubernetes_e2e.py
      image: gcr.io/gke-test-infra/kubekins-e2e:v20181221-f9eff05-master

- decorate: true
  decoration_config:
    timeout: 6000000000000 # 100 minutes
  interval: 30m
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  name: ci-kubernetes-e2e-gke-staging-stable1-parallel
  spec:
    containers:
    - args:
      - --check-leaked-resources
      - --check-version-skew=false
      - --cluster=
      - --deployment=gke
      - --extract=gke-latest-1.11
      - --gcp-cloud-sdk=gs://cloud-sdk-testing/rc
      - --gcp-node-image=gci
      - --gcp-project-type=gke-internal-project
      - --gcp-zone=us-central1-f
      - --ginkgo-parallel
      - --gke-environment=staging
      - --provider=gke
      - --test_args=--ginkgo.skip=\[Slow\]|\[Serial\]|\[Disruptive\]|\[Flaky\]|\[Feature:.+\] --minStartupPods=8
      - --timeout=80m
      command:
      - runner.sh
      - /workspace/scenarios/kubernetes_e2e.py
      image: gcr.io/gke-test-infra/kubekins-e2e:v20181221-f9eff05-master

- decorate: true
  decoration_config:
    timeout: 49200000000000 # 820 minutes
  interval: 30m
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  name: ci-kubernetes-e2e-gke-staging-stable1-serial
  spec:
    containers:
    - args:
      - --check-leaked-resources
      - --check-version-skew=false
      - --cluster=
      - --deployment=gke
      - --extract=gke-latest-1.11
      - --gcp-cloud-sdk=gs://cloud-sdk-testing/rc
      - --gcp-node-image=gci
      - --gcp-project-type=gke-internal-project
      - --gcp-zone=us-central1-f
      - --gke-environment=staging
      - --provider=gke
      - --test_args=--ginkgo.focus=\[Slow\]|\[Serial\]|\[Disruptive\] --ginkgo.skip=\[Flaky\]|\[Feature:.+\] --minStartupPods=8
      - --timeout=800m
      command:
      - runner.sh
      - /workspace/scenarios/kubernetes_e2e.py
      image: gcr.io/gke-test-infra/kubekins-e2e:v20181221-f9eff05-master

- decorate: true
  decoration_config:
    timeout: 6000000000000 # 100 minutes
  interval: 30m
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  name: ci-kubernetes-e2e-gke-staging-stable2-parallel
  spec:
    containers:
    - args:
      - --check-leaked-resources
      - --check-version-skew=false
      - --cluster=
      - --deployment=gke
      - --extract=gke-latest-1.12
      - --gcp-cloud-sdk=gs://cloud-sdk-testing/rc
      - --gcp-node-image=gci
      - --gcp-project-type=gke-internal-project
      - --gcp-zone=us-central1-f
      - --ginkgo-parallel
      - --gke-environment=staging
      - --provider=gke
      - --test_args=--ginkgo.skip=\[Slow\]|\[Serial\]|\[Disruptive\]|\[Flaky\]|\[Feature:.+\] --minStartupPods=8
      - --timeout=80m
      command:
      - runner.sh
      - /workspace/scenarios/kubernetes_e2e.py
      image: gcr.io/gke-test-infra/kubekins-e2e:v20181221-f9eff05-master

- decorate: true
  decoration_config:
    timeout: 61200000000000 # 1020 minutes
  interval: 30m
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  name: ci-kubernetes-e2e-gke-staging-stable2-serial
  spec:
    containers:
    - args:
      - --check-leaked-resources
      - --check-version-skew=false
      - --cluster=
      - --deployment=gke
      - --extract=gke-latest-1.12
      - --gcp-cloud-sdk=gs://cloud-sdk-testing/rc
      - --gcp-node-image=gci
      - --gcp-project-type=gke-internal-project
      - --gcp-zone=us-central1-f
      - --gke-environment=staging
      - --provider=gke
      - --test_args=--ginkgo.focus=\[Slow\]|\[Serial\]|\[Disruptive\] --ginkgo.skip=\[Flaky\]|\[Feature:.+\] --minStartupPods=8
      - --timeout=1000m
      command:
      - runner.sh
      - /workspace/scenarios/kubernetes_e2e.py
      image: gcr.io/gke-test-infra/kubekins-e2e:v20181221-f9eff05-master

- decorate: true
  decoration_config:
    timeout: 6000000000000 # 100 minutes
  extra_refs:
  - org: istio
    repo: istio
    base_ref: tags/1.0.3
    path_alias: istio.io/istio
  interval: 30m
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  name: periodic-e2e-gke-staging-1-11-istio-addon
  spec:
    containers:
    - args:
      - --cluster=istio-e2e
      - --deployment=gke
      - --env=CLOUDSDK_CONTAINER_USE_V1_API=false
      - --env=HUB=docker.io/istio
      - --env=TAG=1.0.3
      - --env=ISTIO_OUT=/workspace
      - --extract=gke-latest-1.11
      - --gcp-cloud-sdk=gs://cloud-sdk-testing/ci/staging
      - --gcp-node-image=gci
      - --gcp-project-type=gke-internal-project
      - --gcp-zone=us-central1-f
      - --gke-command-group=beta
      - --gke-create-command=container clusters create --quiet --num-nodes=4 --no-enable-legacy-authorization --addons=Istio --istio-config=auth=MTLS_PERMISSIVE
      - --gke-environment=test
      - --provider=gke
      - --test=false
      - --test-cmd=bash
      - --test-cmd-args=-c
      - --test-cmd-args=sleep 300 && kubectl delete deployment -n istio-system prometheus && export JUNIT_E2E_XML="${ARTIFACTS}/junit.xml" && make -C .. with_junit_report TARGET=e2e_bookinfo_envoyv2_v1alpha3 E2E_ARGS='--skip_setup --namespace=istio-system --test.run=Test[^DbRoutingMysql]' && gcloud beta container clusters update istio-e2e --project=$PROJECT --zone=$ZONE --update-addons=Istio=DISABLED
      - --test-cmd-name=istio-addon
      - --timeout=80m
      command:
      - runner.sh
      - /workspace/scenarios/kubernetes_e2e.py
      image: gcr.io/gke-test-infra/kubekins-e2e:v20181221-f9eff05-master

- decorate: true
  decoration_config:
    timeout: 6000000000000 # 100 minutes
  interval: 30m
  extra_refs:
  - org: gke-internal.googlesource.com/cloud-services-mesh-team
    repo: csm-sync-agent
    base_ref: master
    path_alias: gke-internal.googlesource.com/cloud-services-mesh-team/csm-sync-agent
    clone_uri: https://gke-internal.googlesource.com/cloud-services-mesh-team/csm-sync-agent
  labels:
    preset-service-account: "true"
    preset-k8s-ssh: "true"
  name: periodic-e2e-gke-staging-latest-csm-addon
  spec:
    containers:
    - args:
      - --check-leaked-resources
      - --cluster=csm-e2e
      - --deployment=gke
      - --env=CLOUDSDK_CONTAINER_USE_V1_API=false
      - --env=CLOUDSDK_API_ENDPOINT_OVERRIDES_CONTAINER=https://staging-container.sandbox.googleapis.com/
      - --extract=gke-latest
      - --gcp-cloud-sdk=gs://csm-alpha-artifacts/gcloud/
      - --gcp-node-image=gci
      - --gcp-project=csm-e2e-test
      - --gcp-zone=us-central1-f
      - --gke-create-command=alpha container clusters create --quiet --num-nodes=4 --no-enable-legacy-authorization --addons=Istio --istio-config=auth=MTLS_PERMISSIVE,csm-mesh-name=projects/1234/meshes/1234
      - --gke-environment=staging
      - --provider=gke
      - --test=false
      - --test-cmd=../e2e/e2e-prow.sh
      - --test-cmd-name=csm-addon
      - --timeout=80m
      command:
      - runner.sh
      - /workspace/scenarios/kubernetes_e2e.py
      image: gcr.io/gke-test-infra/kubekins-e2e:v20181221-f9eff05-master
